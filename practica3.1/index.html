
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../practica4.5/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>Práctica 3.1 - IAW</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-iaw-31-instalacion-de-moodle-con-ansible" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="IAW" class="md-header__button md-logo" aria-label="IAW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IAW
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Práctica 3.1
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="IAW" class="md-nav__button md-logo" aria-label="IAW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    IAW
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Principal
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acerca de
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 1
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica5.4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 5.4
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica4.5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 4.5
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Práctica 3.1
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Práctica 3.1
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#estructura-de-la-practica" class="md-nav__link">
    <span class="md-ellipsis">
      Estructura de la Práctica
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objetivo-de-la-practica" class="md-nav__link">
    <span class="md-ellipsis">
      Objetivo de la Práctica
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recordatorio-de-cambio-de-la-direccion-ip-para-actualizar-el-nombre-de-dominio-nuestra-pagina-web" class="md-nav__link">
    <span class="md-ellipsis">
      Recordatorio de cambio de la dirección IP para actualizar el nombre de dominio nuestra página web
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proceso-de-instalacion-y-configuracion-de-moodle" class="md-nav__link">
    <span class="md-ellipsis">
      Proceso de instalación y configuración de Moodle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proceso de instalación y configuración de Moodle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables-incluidas-en-el-archivo-envars" class="md-nav__link">
    <span class="md-ellipsis">
      Variables incluidas en el archivo ".envars"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprobaciones-generales" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobaciones generales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sitio-moodle" class="md-nav__link">
    <span class="md-ellipsis">
      Sitio Moodle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#estructura-de-la-practica" class="md-nav__link">
    <span class="md-ellipsis">
      Estructura de la Práctica
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objetivo-de-la-practica" class="md-nav__link">
    <span class="md-ellipsis">
      Objetivo de la Práctica
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recordatorio-de-cambio-de-la-direccion-ip-para-actualizar-el-nombre-de-dominio-nuestra-pagina-web" class="md-nav__link">
    <span class="md-ellipsis">
      Recordatorio de cambio de la dirección IP para actualizar el nombre de dominio nuestra página web
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proceso-de-instalacion-y-configuracion-de-moodle" class="md-nav__link">
    <span class="md-ellipsis">
      Proceso de instalación y configuración de Moodle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proceso de instalación y configuración de Moodle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables-incluidas-en-el-archivo-envars" class="md-nav__link">
    <span class="md-ellipsis">
      Variables incluidas en el archivo ".envars"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprobaciones-generales" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobaciones generales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sitio-moodle" class="md-nav__link">
    <span class="md-ellipsis">
      Sitio Moodle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="practica-iaw-31-instalacion-de-moodle-con-ansible">Practica-IAW-3.1: Instalación de Moodle con Ansible</h1>
<h2 id="estructura-de-la-practica">Estructura de la Práctica</h2>
<p><img alt="Estructura" src="../Imagenes/Img-3.1/Estructura.png" /></p>
<h2 id="objetivo-de-la-practica">Objetivo de la Práctica</h2>
<p>El objetivo de esta práctica es automatizar la instalación y configuración de Moodle en AWS utilizando Ansible. Para ello, se desplegará una arquitectura de dos niveles, con:</p>
<ol>
<li>Un servidor frontend: Donde llevaremos a cabo la instalación de Apache, PHP y Moodle.</li>
<li>Un servidor backend: Incluyendo la instalación de MySQL cómo base de datos.</li>
<li>Un nodo de control (dónde se ejecuta Ansible): Desde aquí se automatizará la instalación y configuración de las instancias EC2.</li>
</ol>
<h2 id="recordatorio-de-cambio-de-la-direccion-ip-para-actualizar-el-nombre-de-dominio-nuestra-pagina-web">Recordatorio de cambio de la dirección IP para actualizar el nombre de dominio nuestra página web</h2>
<blockquote>
<p>[!IMPORTANT]<br />
Tal y cómo hemos visto en las prácticas anteriores, hemos creado un dominio para nuestra página web, de forma que, esté asociada a la dirección IP de nuestra máquina, por lo que nos dirigimos a la página NO-IP y actualizamos la dirección IP, el nombre no se permite cambiar, por lo que en este caso solo cambiaremos la dirección IP.</p>
</blockquote>
<p><img alt="Hostnames" src="../Imagenes/Img-3.1/Hostnames.png" /></p>
<h2 id="proceso-de-instalacion-y-configuracion-de-moodle">Proceso de instalación y configuración de Moodle</h2>
<ul>
<li><strong><code>install_lamp_backend.yaml</code>:</strong> Este archivo playbook de Ansible tiene como objetivo configurar y desplegar un servidor MySQL en la instancia backend de AWS, automatizando su instalación, configuración y la creación de la base de datos para Moodle.</li>
</ul>
<p><strong>Contenido del archivo:</strong> </p>
<pre><code class="language-bash">
    - name: Configuración del Servidor de Base de Datos (Backend)
  hosts: backend
  become: yes

  vars_files:
    - ../vars/variables.yml

  tasks:

    - name: Actualizar paquetes
      apt:
        update_cache: yes
        upgrade: yes

    - name: Instalamos MySQL Server
      apt:
        name: mysql-server
        state: present

    - name: Habilitamos el servicio MySQL
      service:
        name: mysql
        state: started
        enabled: yes

    - name: Instalamos el módulo pymysql
      apt:
        name: python3-pymysql
        state: present

    - name: Eliminamos la base de datos por si existe
      mysql_db:
        name: &quot;{{ db.name }}&quot;
        state: absent
        login_unix_socket: /var/run/mysqld/mysqld.sock

    - name: Creamos la base de datos para Moodle
      mysql_db:
        name: &quot;{{ db.name }}&quot;
        state: present
        login_unix_socket: /var/run/mysqld/mysqld.sock

    - name: Creamos un usuario de la base de datos para Moodle
      mysql_user:
        name: &quot;{{ db.user }}&quot;
        password: &quot;{{ db.password }}&quot;
        priv: &quot;{{ db.name }}.*:ALL&quot;
        host: &quot;{{ db.frontend_private_ip }}&quot;
        state: present
        login_unix_socket: /var/run/mysqld/mysqld.sock

    - name: Permitimos conexiones remotas a MySQL
      lineinfile:
        path: /etc/mysql/mysql.conf.d/mysqld.cnf
        regexp: '^bind-address'
        line: 'bind-address = 0.0.0.0'

    - name: Reiniciamos MySQL
      service:
        name: mysql
        state: restarted

</code></pre>
<ul>
<li><strong><code>install_lamp_frontend.yaml</code>:</strong> El objetivo es configurar un servidor web Apache con PHP en una instancia EC2 de AWS, que actuará como capa frontend de la arquitectura de dos niveles para la instalación de Moodle.</li>
</ul>
<p><strong>Contenido del archivo:</strong> </p>
<pre><code class="language-bash">
    - name: Configuración del Servidor Web (Frontend)
  hosts: frontend
  become: yes
  tasks:
    - name: Actualizamos paquetes
      apt:
        update_cache: yes
        upgrade: yes

    - name: Instalamos el servidor web Apache
      apt:
        name: apache2
        state: present

    - name: Instalamos PHP así cómo sus dependencias
      apt:
        name:
          - php
          - php-mysql
          - libapache2-mod-php
          - php-xml
          - php-curl
          - php-mbstring
          - php-zip
          - php-gd
          - unzip
          - php-intl
          - php-soap
          - php-ldap
          - php-opcache
          - php-cli
        state: present

    - name: Creamos el directorio de datos de moodle
      file:
        path: /var/www/moodledata
        state: directory
        owner: www-data
        group: www-data
        mode: '0755'

    - name: Modificamos el valor max_input_vars de PHP
      replace: 
        path: /etc/php/8.3/apache2/php.ini
        regexp: '^;max_input_vars\s=.*'
        replace: max_input_vars = 5000

    - name: Modificamos el valor max_input_vars de PHP
      replace: 
        path: /etc/php/8.3/cli/php.ini
        regexp: '^;max_input_vars\s=.*'
        replace: max_input_vars = 5000

    - name: Modificamos el valor memory_limit de PHP
      replace: 
        path: /etc/php/8.3/apache2/php.ini
        regexp: '^;memory_limit\s=.*'
        replace: memory_limit = 256M

    - name: Modificamos el valor memory_limit de PHP CLI
      replace:
        path: /etc/php/8.3/cli/php.ini
        regexp: '^;memory_limits\s=.*'
        replace: memory_limit = 256M

    - name: Modificamos el valor post_max_size de PHP
      replace: 
        path: /etc/php/8.3/apache2/php.ini
        regexp: '^;post_max_size\s=.*'
        replace: post_max_size = 128M

    - name: Modificamos el valor post_max_size de PHP
      replace: 
        path: /etc/php/8.3/cli/php.ini
        regexp: '^;post_max_size\s=.*'
        replace: post_max_size = 128M

    - name: Modificamos el valor upload_max_filesize de PHP
      replace:
        path: /etc/php/8.3/apache2/php.ini
        regexp: '^;upload_max_filesize\s=.*'
        replace: upload_max_filesize = 128M

    - name: Modificamos el valor upload_max_filesize de PHP
      replace:
        path: /etc/php/8.3/cli/php.ini
        regexp: '^;upload_max_filesize\s=.*'
        replace: upload_max_filesize = 128M

    - name: Modificamos el valor max_execution_time de PHP
      replace:
        path: /etc/php/8.3/apache2/php.ini
        regexp: '^;max_execution_time\s=.*'
        replace: 'max_execution_time = 300'

    - name: Modificamos el valor max_execution_time de PHP CLI
      replace:
        path: /etc/php/8.3/cli/php.ini
        regexp: '^;max_execution_time\s=.*'
        replace: 'max_execution_time = 300'

    - name: Copiamos el archivo de configuración de Apache
      copy:
        src: ../templates/000-default.conf
        dest: /etc/apache2/sites-available/
        mode: 0755

    - name: Habilitamos el módulo rewrite de Apache
      apache2_module:
            name: rewrite
            state: present

    - name: Reiniciamos Apache
      service:
        name: apache2
        state: restarted

</code></pre>
<ul>
<li><strong><code>deploy.yaml</code>:</strong> Tiene como objetivo principal la instalación y configuración automática de Moodle en un servidor frontend utilizando Ansible. </li>
</ul>
<p><strong>Contenido del archivo:</strong> </p>
<pre><code class="language-bash">
    - name: Instalación de Moodle
  hosts: frontend
  become: yes
  vars_files:
    - ../vars/variables.yml

  tasks:

    - name: Eliminamos archivos previos en el directorio de moodle
      file:
          path: /var/www/html/*
          state: absent

    - name: Descargamos Moodle
      get_url:
        url: &quot;https://github.com/moodle/moodle/archive/refs/tags/v4.3.1.zip &quot;
        dest: &quot;/tmp&quot;

    - name: Instalamos el descomprimidor unzip
      apt: 
        name: unzip
        state: present

    - name: Extraemos Moodle
      unarchive:
        src: /tmp/moodle-4.3.1.zip
        dest: /tmp
        remote_src: yes

    - name: Copiamos moodle a su directorio /var/www/html
      copy:
        src: /tmp/moodle-4.3.1/
        dest: /var/www/html
        remote_src: true
        force: yes

    - name: Configuramos permisos de Moodle
      file:
        path: /var/www/html
        owner: www-data
        group: www-data
        recurse: yes
        mode: &quot;0755&quot;
      loop:
        - /var/www/html
        - /var/www/html/moodledata

    - name: Instalamos Moodle desde CLI
      command:
        sudo -u www-data php /var/www/html/admin/cli/install.php \
        --wwwroot={{ moodle.wwwroot }} \
        --dataroot={{ moodle.data_directory }} \
        --dbtype={{ moodle.type }} \
        --dbhost={{ db.host }} \
        --dbname={{ db.name }} \
        --dbuser={{ db.user }} \
        --dbpass={{ db.password }} \
        --fullname=&quot;{{ moodle.fullname }}&quot; \
        --shortname=&quot;{{ moodle.shortname }}&quot; \
        --summary=&quot;{{ moodle.summary }}&quot; \
        --adminuser={{ moodle.admin_user }} \
        --adminpass={{ moodle.admin_pass }} \
        --adminemail={{ moodle.admin_email }} \
        --non-interactive \
        --agree-license

      args:
        chdir: /var/www/html

    - name: Reiniciamos Apache
      service:
        name: apache2
        state: restarted


</code></pre>
<p>Y por último, configuraremos letsencrypt para que nuestra página web sea HTTPS.</p>
<ul>
<li><strong><code>deploy.yaml</code>:</strong> Tiene como objetivo principal la instalación y configuración automática de Moodle en un servidor frontend utilizando Ansible. </li>
</ul>
<p><strong>Contenido del archivo:</strong> </p>
<pre><code class="language-bash">
- name: Configuración de HTTPS con Let's Encrypt
  hosts: frontend
  become: yes
  vars_files:
    - ../vars/variables.yml

  tasks:

    - name: Desinstalamos instalaciones previas de Certbot
      apt:
        name: certbot
        state: absent

    - name: Instalamos Certbot con el gestor de paquetes snap
      snap:
        name: certbot
        classic: yes
        state: present

    - name: Solicitamos y configuramos el certificado SSL/TLS a Let's Encrypt con certbot
      command:
          certbot --apache \
          -m {{ certbot.email }} \
          --agree-tos \
          --no-eff-email \
          --non-interactive \
          -d {{ certbot.domain }}

    - name: Reiniciamos Apache para aplicar los cambios
      service:
        name: apache2
        state: restarted
</code></pre>
<blockquote>
<p>[!NOTE]<br />
Añadiremos las líneas "ServerSignature Off" y "ServerTokens Prod" en el archivo 000-default.conf para mejorar la seguridad de nuestro servidor apache.</p>
</blockquote>
<p>Explicado el motivo, el archivo 000-default.conf quedará de la siguiente manera:</p>
<p><img alt="Default" src="../Imagenes/Img-3.1/Default.png" /></p>
<blockquote>
<p>[!IMPORTANT]<br />
Cómo hemos podido observar anteriormente, tenemos una carpeta en nuestra estructura llamada "inventory", esta carpeta incluye las direcciones IPs de las máquinas a controlar (frontend y backend), usuario de ansible así cómo la clave a usar para la conexión con las mismas. Cabe recordar tras adjuntar al repo la clave, ejecutar el comando "chmod 400 vockey.pem" para que no de problemas la conexión y tenga los permisos necesarios</p>
</blockquote>
<p><img alt="Inventario" src="../Imagenes/Img-3.1/inventario.png" /></p>
<p>También tenemos un archivo llamado "main.yaml", dónde le especificamos a Ansible los archivos que deseamos ejecutar sobre los dispositivos a manejar.</p>
<p><img alt="Main" src="../Imagenes/Img-3.1/main.png" /></p>
<h3 id="variables-incluidas-en-el-archivo-envars">Variables incluidas en el archivo ".envars"</h3>
<p><img alt="Variables" src="../Imagenes/Img-3.1/Variables.png" /></p>
<h3 id="comprobaciones-generales">Comprobaciones generales</h3>
<p>Una vez redactados los comandos útiles, probaremos la ejecución del script de modo que se ejecute sin errores.</p>
<p><img alt="Ejecución Install Backend" src="../Imagenes/Img-3.1/Backend.png" /></p>
<p><img alt="Ejecución Install Frontend" src="../Imagenes/Img-3.1/Frontend.png" /></p>
<p><img alt="Ejecución Deploy" src="../Imagenes/Img-3.1/Deploy.png" /></p>
<p>Y para finalizar, ejecutaremos el archivo "setup letsencrypt"</p>
<p><img alt="Ejecución LetsEncrypt" src="../Imagenes/Img-3.1/Letsencrypt.png" /></p>
<h3 id="sitio-moodle">Sitio Moodle</h3>
<p>Una vez ejecutado todos los scripts con éxito, introduciremos el nombre de nuestro dominio y cargará la página de nuestro sitio moodle funcionando</p>
<p><img alt="Moodle" src="../Imagenes/Img-3.1/Moodle.png" /></p>
<p><img alt="Certificado" src="../Imagenes/Img-3.1/Certificado.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>